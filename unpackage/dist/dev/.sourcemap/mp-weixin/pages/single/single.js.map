{"version":3,"file":"single.js","sources":["pages/single/single.vue","pages/single/single.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 队员选择 -->\n    <view class=\"section\">\n      <text class=\"section-title\">队员1</text>\n      <view class=\"player-selection\">\n        <view class=\"player-item\">\n          <picker :value=\"selectedPlayer1Index\" :range=\"availablePlayers1\" @change=\"onPlayer1Change\">\n            <view class=\"picker\">\n              <text>{{ player1 || '选择队员1' }}</text>\n              <text class=\"arrow\">▼</text>\n            </view>\n          </picker>\n        </view>\n        \n        <view class=\"vs-text\">vs</view>\n        \n        <view class=\"player-item\">\n          <picker :value=\"selectedPlayer2Index\" :range=\"availablePlayers2\" @change=\"onPlayer2Change\">\n            <view class=\"picker\">\n              <text>{{ player2 || '选择队员2' }}</text>\n              <text class=\"arrow\">▼</text>\n            </view>\n          </picker>\n        </view>\n      </view>\n    </view>\n\n    <!-- 比分输入 -->\n    <view class=\"section\">\n      <text class=\"section-title\">比分</text>\n      <view class=\"score-section\">\n        <view class=\"score-item\">\n          <text class=\"player-name\">{{ player1 || '队员1' }}</text>\n          <view class=\"score-input\">\n            <input \n              type=\"number\" \n              v-model=\"score1\" \n              placeholder=\"0\"\n              @input=\"onScore1Input\"\n            />\n          </view>\n        </view>\n        \n        <view class=\"vs-text\">vs</view>\n        \n        <view class=\"score-item\">\n          <text class=\"player-name\">{{ player2 || '队员2' }}</text>\n          <view class=\"score-input\">\n            <input \n              type=\"number\" \n              v-model=\"score2\" \n              placeholder=\"0\"\n              @input=\"onScore2Input\"\n            />\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 提交按钮 -->\n    <view class=\"submit-section\">\n      <button \n        class=\"submit-btn\" \n        :class=\"{ disabled: !canSubmit }\" \n        @click=\"submitScore\"\n        :disabled=\"!canSubmit\"\n      >\n        提交比分\n      </button>\n    </view>\n\n    <!-- 今日已提交 -->\n    <view class=\"section\">\n      <text class=\"section-title\">今日已提交:</text>\n      <view class=\"today-matches\">\n        <view v-if=\"todayMatches.length === 0\" class=\"no-data\">\n          <text>暂无数据</text>\n        </view>\n        <view v-else class=\"matches-list\">\n          <view class=\"matches-header\">\n            <text class=\"header-item\">对战</text>\n            <text class=\"header-item\">比分</text>\n            <text class=\"header-item\">操作</text>\n          </view>\n          <view \n            v-for=\"match in todayMatches\" \n            :key=\"match.id\" \n            class=\"match-item\"\n          >\n            <text class=\"match-players\">{{ match.player1 }}-{{ match.player2 }}</text>\n            <text class=\"match-score\">{{ match.score1 }} - {{ match.score2 }}</text>\n            <text class=\"match-action\">🟢</text>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 弹窗 -->\n    <view v-if=\"showPlayerModal\" class=\"modal-overlay\" @click=\"closePlayerModal\">\n      <view class=\"modal-content\" @click.stop>\n        <view class=\"modal-header\">\n          <text class=\"modal-title\">选择队员</text>\n        </view>\n        <view class=\"modal-body\">\n          <view \n            v-for=\"(player, index) in modalPlayerList\" \n            :key=\"index\"\n            class=\"player-option\"\n            @click=\"selectPlayer(player)\"\n          >\n            <text>{{ player }}</text>\n          </view>\n        </view>\n        <view class=\"modal-footer\">\n          <button class=\"modal-btn\" @click=\"closePlayerModal\">取消</button>\n          <button class=\"modal-btn confirm\" @click=\"confirmPlayer\">确认</button>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 自定义 tabBar -->\n    <custom-tabbar ref=\"customTabbar\" />\n  </view>\n</template>\n\n<script>\nimport { getPlayers, saveSingleMatch, getSingleMatches, initPlayers } from '@/utils/storage.js'\nimport CustomTabbar from '@/components/custom-tabbar/custom-tabbar.vue'\n\nexport default {\n  components: {\n    CustomTabbar\n  },\n  data() {\n    return {\n      players: [],\n      player1: '',\n      player2: '',\n      score1: '',\n      score2: '',\n      selectedPlayer1Index: -1,\n      selectedPlayer2Index: -1,\n      todayMatches: [],\n      showPlayerModal: false,\n      modalPlayerList: [],\n      selectingPlayer: '', // 'player1' or 'player2'\n      selectedModalPlayer: ''\n    }\n  },\n  \n  computed: {\n    availablePlayers1() {\n      return this.players.filter(player => player !== this.player2)\n    },\n    \n    availablePlayers2() {\n      return this.players.filter(player => player !== this.player1)\n    },\n    \n    canSubmit() {\n      return this.player1 && \n             this.player2 && \n             this.player1 !== this.player2 &&\n             this.score1 !== '' && \n             this.score2 !== '' &&\n             (parseInt(this.score1) > 0 || parseInt(this.score2) > 0)\n    }\n  },\n  \n  onLoad() {\n    this.loadData()\n  },\n  \n  onShow() {\n    this.loadTodayMatches()\n    // 更新tab状态\n    this.$nextTick(() => {\n      if (this.$refs.customTabbar) {\n        this.$refs.customTabbar.setCurrentIndex()\n      }\n    })\n  },\n  \n  methods: {\n    async loadData() {\n      try {\n        console.log('开始加载队员数据...')\n        this.players = await getPlayers()\n        console.log('获取到的队员列表:', this.players)\n        \n        if (this.players.length === 0) {\n          console.log('队员列表为空，尝试初始化...')\n          uni.showLoading({\n            title: '正在初始化数据...'\n          })\n          \n          // 尝试初始化队员\n          const initResult = await initPlayers()\n          console.log('初始化结果:', initResult)\n          \n          uni.hideLoading()\n          \n          if (initResult) {\n            this.players = await getPlayers()\n            console.log('重新获取队员列表:', this.players)\n            uni.showToast({\n              title: '数据初始化成功',\n              icon: 'success'\n            })\n          } else {\n            // 初始化失败，使用降级数据\n            this.players = ['吉志', '小鲁', '建华', '汪骏', '杭宁']\n            uni.showToast({\n              title: '网络异常，使用离线数据',\n              icon: 'none',\n              duration: 3000\n            })\n          }\n        }\n        \n        this.loadTodayMatches()\n      } catch (error) {\n        console.error('加载队员数据失败:', error)\n        // 使用默认队员数据\n        this.players = ['吉志', '小鲁', '建华', '汪骏', '杭宁']\n        uni.showToast({\n          title: '网络异常，使用离线数据',\n          icon: 'none',\n          duration: 3000\n        })\n      }\n    },\n    \n    async loadTodayMatches() {\n      const allMatches = await getSingleMatches('today')\n      this.todayMatches = allMatches\n    },\n    \n    onPlayer1Change(e) {\n      this.selectedPlayer1Index = e.detail.value\n      this.player1 = this.availablePlayers1[e.detail.value]\n      this.adjustPlayer2Index()\n    },\n    \n    onPlayer2Change(e) {\n      this.selectedPlayer2Index = e.detail.value\n      this.player2 = this.availablePlayers2[e.detail.value]\n      this.adjustPlayer1Index()\n    },\n    \n    adjustPlayer1Index() {\n      if (this.player1) {\n        this.selectedPlayer1Index = this.availablePlayers1.indexOf(this.player1)\n      }\n    },\n    \n    adjustPlayer2Index() {\n      if (this.player2) {\n        this.selectedPlayer2Index = this.availablePlayers2.indexOf(this.player2)\n      }\n    },\n    \n    onScore1Input(e) {\n      this.score1 = e.detail.value\n    },\n    \n    onScore2Input(e) {\n      this.score2 = e.detail.value\n    },\n    \n    async submitScore() {\n      if (!this.canSubmit) {\n        return\n      }\n      \n      uni.showLoading({\n        title: '提交中...'\n      })\n      \n      try {\n        const match = {\n          player1: this.player1,\n          player2: this.player2,\n          score1: parseInt(this.score1),\n          score2: parseInt(this.score2)\n        }\n        \n        const result = await saveSingleMatch(match)\n        if (result) {\n          uni.showToast({\n            title: '提交成功',\n            icon: 'success'\n          })\n          \n          // 重置表单\n          this.resetForm()\n          // 刷新今日比赛\n          this.loadTodayMatches()\n        } else {\n          uni.showToast({\n            title: '提交失败',\n            icon: 'error'\n          })\n        }\n      } catch (error) {\n        console.error('提交失败:', error)\n        uni.showToast({\n          title: '提交失败',\n          icon: 'error'\n        })\n      } finally {\n        uni.hideLoading()\n      }\n    },\n    \n    resetForm() {\n      this.player1 = ''\n      this.player2 = ''\n      this.score1 = ''\n      this.score2 = ''\n      this.selectedPlayer1Index = -1\n      this.selectedPlayer2Index = -1\n    },\n    \n    showPlayerSelector(playerType) {\n      this.selectingPlayer = playerType\n      this.modalPlayerList = playerType === 'player1' ? this.availablePlayers1 : this.availablePlayers2\n      this.showPlayerModal = true\n    },\n    \n    selectPlayer(player) {\n      this.selectedModalPlayer = player\n    },\n    \n    confirmPlayer() {\n      if (this.selectedModalPlayer) {\n        if (this.selectingPlayer === 'player1') {\n          this.player1 = this.selectedModalPlayer\n          this.adjustPlayer1Index()\n        } else {\n          this.player2 = this.selectedModalPlayer\n          this.adjustPlayer2Index()\n        }\n      }\n      this.closePlayerModal()\n    },\n    \n    closePlayerModal() {\n      this.showPlayerModal = false\n      this.selectedModalPlayer = ''\n      this.selectingPlayer = ''\n    }\n  }\n}\n</script>\n\n<style scoped>\n.container {\n  padding: 32rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  padding-bottom: 120rpx; /* 为自定义 tabBar 留出空间 */\n}\n\n.section {\n  margin-bottom: 48rpx;\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 24rpx;\n  display: block;\n}\n\n.player-selection {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: white;\n  border-radius: 16rpx;\n  padding: 32rpx;\n  box-shadow: 0 4rpx 16rpx rgba(0,0,0,0.1);\n}\n\n.player-item {\n  flex: 1;\n}\n\n.picker {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 24rpx;\n  background: #f8f8f8;\n  border-radius: 12rpx;\n  border: 2rpx solid #e0e0e0;\n}\n\n.picker text:first-child {\n  color: #333;\n  font-size: 28rpx;\n}\n\n.arrow {\n  color: #666;\n  font-size: 24rpx;\n}\n\n.vs-text {\n  margin: 0 24rpx;\n  font-size: 28rpx;\n  font-weight: bold;\n  color: #4CAF50;\n}\n\n.score-section {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: white;\n  border-radius: 16rpx;\n  padding: 32rpx;\n  box-shadow: 0 4rpx 16rpx rgba(0,0,0,0.1);\n}\n\n.score-item {\n  flex: 1;\n  text-align: center;\n}\n\n.player-name {\n  display: block;\n  font-size: 28rpx;\n  color: #666;\n  margin-bottom: 16rpx;\n}\n\n.score-input {\n  background: #f8f8f8;\n  border-radius: 12rpx;\n  border: 2rpx solid #e0e0e0;\n  overflow: hidden;\n}\n\n.score-input input {\n  width: 100%;\n  padding: 24rpx;\n  text-align: center;\n  font-size: 36rpx;\n  font-weight: bold;\n  background: transparent;\n  border: none;\n}\n\n.submit-section {\n  margin-bottom: 48rpx;\n}\n\n.submit-btn {\n  width: 100%;\n  background: #4CAF50;\n  color: white;\n  border: none;\n  border-radius: 50rpx;\n  padding: 32rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n}\n\n.submit-btn.disabled {\n  background: #ccc;\n}\n\n.today-matches {\n  background: white;\n  border-radius: 16rpx;\n  overflow: hidden;\n  box-shadow: 0 4rpx 16rpx rgba(0,0,0,0.1);\n}\n\n.no-data {\n  padding: 80rpx;\n  text-align: center;\n  color: #999;\n}\n\n.matches-header {\n  display: flex;\n  background: #f8f8f8;\n  padding: 24rpx 32rpx;\n  border-bottom: 2rpx solid #e0e0e0;\n}\n\n.header-item {\n  flex: 1;\n  text-align: center;\n  font-size: 28rpx;\n  color: #666;\n  font-weight: bold;\n}\n\n.match-item {\n  display: flex;\n  padding: 24rpx 32rpx;\n  border-bottom: 2rpx solid #f0f0f0;\n}\n\n.match-item:last-child {\n  border-bottom: none;\n}\n\n.match-players,\n.match-score,\n.match-action {\n  flex: 1;\n  text-align: center;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0,0,0,0.5);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.modal-content {\n  background: white;\n  margin: 32rpx;\n  border-radius: 16rpx;\n  overflow: hidden;\n  max-height: 80vh;\n}\n\n.modal-header {\n  padding: 32rpx;\n  background: #f8f8f8;\n  border-bottom: 2rpx solid #e0e0e0;\n}\n\n.modal-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  text-align: center;\n}\n\n.modal-body {\n  max-height: 60vh;\n  overflow-y: auto;\n}\n\n.player-option {\n  padding: 32rpx;\n  border-bottom: 2rpx solid #f0f0f0;\n}\n\n.player-option:last-child {\n  border-bottom: none;\n}\n\n.player-option:active {\n  background: #f0f0f0;\n}\n\n.modal-footer {\n  display: flex;\n  border-top: 2rpx solid #e0e0e0;\n}\n\n.modal-btn {\n  flex: 1;\n  padding: 32rpx;\n  border: none;\n  background: white;\n  font-size: 28rpx;\n}\n\n.modal-btn.confirm {\n  background: #4CAF50;\n  color: white;\n}\n</style>\n","import MiniProgramPage from '/Users/wangjun/netease/mine/Scoring/uniapp/pages/single/single.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getPlayers","initPlayers","getSingleMatches","saveSingleMatch"],"mappings":"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"}