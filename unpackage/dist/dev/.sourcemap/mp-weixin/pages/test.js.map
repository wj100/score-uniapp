{"version":3,"file":"test.js","sources":["pages/test.vue","pages/test.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"header\">\n      <text class=\"title\">云函数测试页面</text>\n    </view>\n    \n    <view class=\"section\">\n      <button class=\"test-btn\" @click=\"testInitPlayers\">1. 初始化队员</button>\n      <button class=\"test-btn\" @click=\"testGetPlayers\">2. 获取队员列表</button>\n      <button class=\"test-btn\" @click=\"testSubmitMatch\">3. 测试提交比赛</button>\n      <button class=\"test-btn\" @click=\"testGetMatches\">4. 测试获取比赛记录</button>\n      <button class=\"test-btn\" @click=\"testErrorHandling\">5. 测试错误处理</button>\n      <button class=\"test-btn\" @click=\"testDatabaseFix\">6. 测试数据库修复</button>\n      <button class=\"test-btn\" @click=\"testTabStatus\">7. 测试Tab状态</button>\n      <button class=\"test-btn\" @click=\"testCloudFunction\">8. 直接测试云函数</button>\n    </view>\n    \n    <view class=\"section\">\n      <text class=\"section-title\">uni-icons 测试:</text>\n      <view class=\"icons-test\">\n        <view class=\"icon-item\">\n          <uni-icons type=\"person\" size=\"30\" color=\"#007AFF\"></uni-icons>\n          <text>person</text>\n        </view>\n        <view class=\"icon-item\">\n          <uni-icons type=\"person-filled\" size=\"30\" color=\"#007AFF\"></uni-icons>\n          <text>person-filled</text>\n        </view>\n        <view class=\"icon-item\">\n          <uni-icons type=\"stats\" size=\"30\" color=\"#4CAF50\"></uni-icons>\n          <text>stats</text>\n        </view>\n        <view class=\"icon-item\">\n          <uni-icons type=\"contact\" size=\"30\" color=\"#FF9800\"></uni-icons>\n          <text>contact</text>\n        </view>\n        <view class=\"icon-item\">\n          <uni-icons type=\"bar-chart\" size=\"30\" color=\"#9C27B0\"></uni-icons>\n          <text>bar-chart</text>\n        </view>\n      </view>\n    </view>\n    \n    <view class=\"result-section\">\n      <text class=\"section-title\">测试结果:</text>\n      <view class=\"result-box\">\n        <text class=\"result-text\">{{ result }}</text>\n      </view>\n    </view>\n    \n    <view class=\"players-section\" v-if=\"players.length > 0\">\n      <text class=\"section-title\">队员列表:</text>\n      <view class=\"players-list\">\n        <view v-for=\"(player, index) in players\" :key=\"index\" class=\"player-item\">\n          <text>{{ player }}</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { getPlayers, initPlayers } from '@/utils/storage.js'\n\nexport default {\n  data() {\n    return {\n      result: '点击按钮开始测试...',\n      players: []\n    }\n  },\n  \n  methods: {\n    async testInitPlayers() {\n      try {\n        this.result = '正在初始化队员...'\n        const result = await initPlayers()\n        this.result = `初始化结果: ${result ? '成功' : '失败'}`\n        console.log('初始化结果:', result)\n      } catch (error) {\n        this.result = `初始化失败: ${error.message}`\n        console.error('初始化失败:', error)\n      }\n    },\n    \n    async testGetPlayers() {\n      try {\n        this.result = '正在获取队员列表...'\n        this.players = await getPlayers()\n        this.result = `获取到 ${this.players.length} 个队员`\n        console.log('获取到的队员:', this.players)\n      } catch (error) {\n        this.result = `获取失败: ${error.message}`\n        console.error('获取队员失败:', error)\n      }\n    },\n    \n    async testSubmitMatch() {\n      try {\n        this.result = '正在测试提交比赛...'\n        \n        const result = await uniCloud.callFunction({\n          name: 'badminton-api',\n          data: {\n            action: 'submitSingleMatch',\n            data: {\n              player1: '言志',\n              player2: '小鲁',\n              score1: 21,\n              score2: 19,\n              match_name: '测试比赛'\n            }\n          }\n        })\n        \n        console.log('提交比赛结果:', result)\n        this.result = `提交比赛结果: ${JSON.stringify(result.result, null, 2)}`\n        \n      } catch (error) {\n        this.result = `提交比赛失败: ${error.message}`\n        console.error('提交比赛失败:', error)\n      }\n    },\n    \n    async testGetMatches() {\n      try {\n        this.result = '正在测试获取比赛记录...'\n        \n        const result = await uniCloud.callFunction({\n          name: 'badminton-api',\n          data: {\n            action: 'getSingleMatches',\n            data: {\n              timeRange: 'all',\n              limit: 5\n            }\n          }\n        })\n        \n        console.log('获取比赛记录结果:', result)\n        \n        if (result.result.code === 0) {\n          console.log('比赛数据:', result.result.data)\n          // 测试日期格式化\n          result.result.data.forEach(match => {\n            console.log('比赛时间戳:', match.time)\n            console.log('比赛日期字符串:', match.date)\n            const testDate = new Date(match.time * 1000)\n            console.log('转换后的日期:', testDate.toLocaleString())\n          })\n        }\n        \n        this.result = `获取比赛记录结果: ${JSON.stringify(result.result, null, 2)}`\n        \n      } catch (error) {\n        this.result = `获取比赛记录失败: ${error.message}`\n        console.error('获取比赛记录失败:', error)\n      }\n    },\n    \n    async testErrorHandling() {\n      try {\n        this.result = '正在测试错误处理机制...'\n        \n        // 模拟数据库资源耗尽错误\n        const result = await uniCloud.callFunction({\n          name: 'badminton-api',\n          data: {\n            action: 'getPlayers'\n          }\n        })\n        \n        console.log('错误处理测试结果:', result)\n        \n        if (result.result.code === -1) {\n          this.result = `检测到错误: ${result.result.message}\\n\\n错误处理机制:\\n1. 自动重试3次\\n2. 使用降级数据\\n3. 显示用户友好提示`\n        } else {\n          this.result = `正常返回: ${JSON.stringify(result.result, null, 2)}`\n        }\n        \n      } catch (error) {\n        this.result = `异常捕获: ${error.message}\\n\\n系统将自动使用降级数据`\n        console.error('错误处理测试异常:', error)\n      }\n    },\n    \n    async testDatabaseFix() {\n      try {\n        this.result = '正在测试数据库操作修复...'\n        \n        // 测试获取队员列表\n        const playersResult = await uniCloud.callFunction({\n          name: 'badminton-api',\n          data: {\n            action: 'getPlayers'\n          }\n        })\n        \n        console.log('获取队员列表结果:', playersResult)\n        \n        if (playersResult.result.code === 0) {\n          this.result = `✅ 数据库操作修复成功！\\n\\n获取队员列表: ${playersResult.result.data.length} 个队员\\n\\n修复内容:\\n1. 所有数据库操作都使用重试机制\\n2. 修复了 collection.where 错误\\n3. 添加了资源耗尽处理\\n4. 优化了错误提示`\n        } else {\n          this.result = `❌ 数据库操作仍有问题: ${playersResult.result.message}`\n        }\n        \n      } catch (error) {\n        this.result = `❌ 测试异常: ${error.message}`\n        console.error('数据库修复测试异常:', error)\n      }\n    },\n    \n    async testTabStatus() {\n      try {\n        this.result = '正在测试Tab状态修复...'\n        \n        // 获取当前页面信息\n        const pages = getCurrentPages()\n        const currentPage = pages[pages.length - 1]\n        const currentRoute = '/' + currentPage.route\n        \n        this.result = `✅ Tab状态修复完成！\\n\\n当前页面: ${currentRoute}\\n\\n修复内容:\\n1. 添加了onShow生命周期监听\\n2. 页面切换时自动更新tab状态\\n3. 添加了ref引用和状态同步\\n4. 优化了切换逻辑和错误处理\\n\\n请尝试切换不同页面，观察tab状态是否正确更新。`\n        \n      } catch (error) {\n        this.result = `❌ Tab状态测试异常: ${error.message}`\n        console.error('Tab状态测试异常:', error)\n      }\n    },\n    \n    async testCloudFunction() {\n      try {\n        this.result = '正在测试云函数连接...'\n        \n        const result = await uniCloud.callFunction({\n          name: 'badminton-api',\n          data: {\n            action: 'getPlayers'\n          }\n        })\n        \n        console.log('云函数原始返回:', result)\n        this.result = `云函数返回: ${JSON.stringify(result.result, null, 2)}`\n        \n      } catch (error) {\n        this.result = `云函数调用失败: ${error.message}`\n        console.error('云函数调用失败:', error)\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.container {\n  padding: 32rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\n\n.header {\n  text-align: center;\n  margin-bottom: 48rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.section {\n  margin-bottom: 48rpx;\n}\n\n.test-btn {\n  width: 100%;\n  background: #4CAF50;\n  color: white;\n  border: none;\n  border-radius: 16rpx;\n  padding: 32rpx;\n  font-size: 28rpx;\n  margin-bottom: 24rpx;\n}\n\n.result-section {\n  margin-bottom: 48rpx;\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 24rpx;\n  display: block;\n}\n\n.result-box {\n  background: white;\n  border-radius: 16rpx;\n  padding: 32rpx;\n  min-height: 200rpx;\n}\n\n.result-text {\n  font-size: 26rpx;\n  color: #666;\n  line-height: 1.5;\n  word-break: break-all;\n}\n\n.players-section {\n  margin-bottom: 48rpx;\n}\n\n.players-list {\n  background: white;\n  border-radius: 16rpx;\n  overflow: hidden;\n}\n\n.player-item {\n  padding: 24rpx 32rpx;\n  border-bottom: 2rpx solid #f0f0f0;\n}\n\n.player-item:last-child {\n  border-bottom: none;\n}\n\n.player-item text {\n  font-size: 28rpx;\n  color: #333;\n}\n\n.icons-test {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 24rpx;\n  background: white;\n  border-radius: 16rpx;\n  padding: 32rpx;\n}\n\n.icon-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 8rpx;\n  min-width: 120rpx;\n}\n\n.icon-item text {\n  font-size: 20rpx;\n  color: #666;\n}\n</style>\n","import MiniProgramPage from '/Users/wangjun/netease/mine/Scoring/uniapp/pages/test.vue'\nwx.createPage(MiniProgramPage)"],"names":["initPlayers","uni","getPlayers","uniCloud"],"mappings":"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"}