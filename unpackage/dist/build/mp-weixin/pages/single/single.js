"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/storage.js"),l={data:()=>({players:[],player1:"",player2:"",score1:"",score2:"",selectedPlayer1Index:-1,selectedPlayer2Index:-1,todayMatches:[],showPlayerModal:!1,modalPlayerList:[],selectingPlayer:"",selectedModalPlayer:""}),computed:{availablePlayers1(){return this.players.filter((e=>e!==this.player2))},availablePlayers2(){return this.players.filter((e=>e!==this.player1))},canSubmit(){return this.player1&&this.player2&&this.player1!==this.player2&&""!==this.score1&&""!==this.score2&&(parseInt(this.score1)>0||parseInt(this.score2)>0)}},onLoad(){this.loadData()},onShow(){this.loadTodayMatches()},methods:{async loadData(){try{if(console.log("开始加载队员数据..."),this.players=await a.getPlayers(),console.log("获取到的队员列表:",this.players),0===this.players.length){console.log("队员列表为空，尝试初始化...");const e=await a.initPlayers();console.log("初始化结果:",e),e&&(this.players=await a.getPlayers(),console.log("重新获取队员列表:",this.players))}this.loadTodayMatches()}catch(l){console.error("加载队员数据失败:",l),this.players=["吉志","小鲁","建华","汪骏","杭宁"],e.index.showToast({title:"加载失败，使用默认数据",icon:"none"})}},async loadTodayMatches(){const e=await a.getSingleMatches("today");this.todayMatches=e},onPlayer1Change(e){this.selectedPlayer1Index=e.detail.value,this.player1=this.availablePlayers1[e.detail.value],this.adjustPlayer2Index()},onPlayer2Change(e){this.selectedPlayer2Index=e.detail.value,this.player2=this.availablePlayers2[e.detail.value],this.adjustPlayer1Index()},adjustPlayer1Index(){this.player1&&(this.selectedPlayer1Index=this.availablePlayers1.indexOf(this.player1))},adjustPlayer2Index(){this.player2&&(this.selectedPlayer2Index=this.availablePlayers2.indexOf(this.player2))},onScore1Input(e){this.score1=e.detail.value},onScore2Input(e){this.score2=e.detail.value},async submitScore(){if(this.canSubmit){e.index.showLoading({title:"提交中..."});try{const l={player1:this.player1,player2:this.player2,score1:parseInt(this.score1),score2:parseInt(this.score2)};await a.saveSingleMatch(l)?(e.index.showToast({title:"提交成功",icon:"success"}),this.resetForm(),this.loadTodayMatches()):e.index.showToast({title:"提交失败",icon:"error"})}catch(l){console.error("提交失败:",l),e.index.showToast({title:"提交失败",icon:"error"})}finally{e.index.hideLoading()}}},resetForm(){this.player1="",this.player2="",this.score1="",this.score2="",this.selectedPlayer1Index=-1,this.selectedPlayer2Index=-1},showPlayerSelector(e){this.selectingPlayer=e,this.modalPlayerList="player1"===e?this.availablePlayers1:this.availablePlayers2,this.showPlayerModal=!0},selectPlayer(e){this.selectedModalPlayer=e},confirmPlayer(){this.selectedModalPlayer&&("player1"===this.selectingPlayer?(this.player1=this.selectedModalPlayer,this.adjustPlayer1Index()):(this.player2=this.selectedModalPlayer,this.adjustPlayer2Index())),this.closePlayerModal()},closePlayerModal(){this.showPlayerModal=!1,this.selectedModalPlayer="",this.selectingPlayer=""}}};const s=e._export_sfc(l,[["render",function(a,l,s,t,r,o){return e.e({a:e.t(r.player1||"选择队员1"),b:r.selectedPlayer1Index,c:o.availablePlayers1,d:e.o(((...e)=>o.onPlayer1Change&&o.onPlayer1Change(...e))),e:e.t(r.player2||"选择队员2"),f:r.selectedPlayer2Index,g:o.availablePlayers2,h:e.o(((...e)=>o.onPlayer2Change&&o.onPlayer2Change(...e))),i:e.t(r.player1||"队员1"),j:e.o([e=>r.score1=e.detail.value,(...e)=>o.onScore1Input&&o.onScore1Input(...e)]),k:r.score1,l:e.t(r.player2||"队员2"),m:e.o([e=>r.score2=e.detail.value,(...e)=>o.onScore2Input&&o.onScore2Input(...e)]),n:r.score2,o:o.canSubmit?"":1,p:e.o(((...e)=>o.submitScore&&o.submitScore(...e))),q:!o.canSubmit,r:0===r.todayMatches.length},0===r.todayMatches.length?{}:{s:e.f(r.todayMatches,((a,l,s)=>({a:e.t(a.player1),b:e.t(a.player2),c:e.t(a.score1),d:e.t(a.score2),e:a.id})))},{t:r.showPlayerModal},r.showPlayerModal?{v:e.f(r.modalPlayerList,((a,l,s)=>({a:e.t(a),b:l,c:e.o((e=>o.selectPlayer(a)),l)}))),w:e.o(((...e)=>o.closePlayerModal&&o.closePlayerModal(...e))),x:e.o(((...e)=>o.confirmPlayer&&o.confirmPlayer(...e))),y:e.o((()=>{})),z:e.o(((...e)=>o.closePlayerModal&&o.closePlayerModal(...e)))}:{})}],["__scopeId","data-v-9110c2f1"]]);wx.createPage(s);
