"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/storage.js"),t={components:{CustomTabbar:()=>"../../components/custom-tabbar/custom-tabbar.js"},data:()=>({players:[],playerA1:"",playerA2:"",playerB1:"",playerB2:"",scoreA:"",scoreB:"",selectedPlayerA1Index:-1,selectedPlayerA2Index:-1,selectedPlayerB1Index:-1,selectedPlayerB2Index:-1,todayMatches:[]}),computed:{selectedPlayers(){return[this.playerA1,this.playerA2,this.playerB1,this.playerB2].filter((e=>e))},availablePlayersA1(){return this.players.filter((e=>!this.selectedPlayers.includes(e)||e===this.playerA1))},availablePlayersA2(){return this.players.filter((e=>!this.selectedPlayers.includes(e)||e===this.playerA2))},availablePlayersB1(){return this.players.filter((e=>!this.selectedPlayers.includes(e)||e===this.playerB1))},availablePlayersB2(){return this.players.filter((e=>!this.selectedPlayers.includes(e)||e===this.playerB2))},canSubmit(){return this.playerA1&&this.playerA2&&this.playerB1&&this.playerB2&&this.playerA1!==this.playerA2&&this.playerB1!==this.playerB2&&4===this.selectedPlayers.length&&4===new Set(this.selectedPlayers).size&&""!==this.scoreA&&""!==this.scoreB&&(parseInt(this.scoreA)>0||parseInt(this.scoreB)>0)}},onLoad(){this.loadData()},onShow(){this.loadTodayMatches()},methods:{async loadData(){try{if(console.log("开始加载队员数据..."),this.players=await a.getPlayers(),console.log("获取到的队员列表:",this.players),0===this.players.length){console.log("队员列表为空，尝试初始化...");const e=await a.initPlayers();console.log("初始化结果:",e),e&&(this.players=await a.getPlayers(),console.log("重新获取队员列表:",this.players))}this.loadTodayMatches()}catch(t){console.error("加载队员数据失败:",t),this.players=["吉志","小鲁","建华","汪骏","杭宁"],e.index.showToast({title:"加载失败，使用默认数据",icon:"none"})}},async loadTodayMatches(){const e=await a.getDoubleMatches("today");this.todayMatches=e},onPlayerA1Change(e){this.selectedPlayerA1Index=e.detail.value,this.playerA1=this.availablePlayersA1[e.detail.value],this.updateAvailableIndexes()},onPlayerA2Change(e){this.selectedPlayerA2Index=e.detail.value,this.playerA2=this.availablePlayersA2[e.detail.value],this.updateAvailableIndexes()},onPlayerB1Change(e){this.selectedPlayerB1Index=e.detail.value,this.playerB1=this.availablePlayersB1[e.detail.value],this.updateAvailableIndexes()},onPlayerB2Change(e){this.selectedPlayerB2Index=e.detail.value,this.playerB2=this.availablePlayersB2[e.detail.value],this.updateAvailableIndexes()},updateAvailableIndexes(){this.playerA1&&(this.selectedPlayerA1Index=this.availablePlayersA1.indexOf(this.playerA1)),this.playerA2&&(this.selectedPlayerA2Index=this.availablePlayersA2.indexOf(this.playerA2)),this.playerB1&&(this.selectedPlayerB1Index=this.availablePlayersB1.indexOf(this.playerB1)),this.playerB2&&(this.selectedPlayerB2Index=this.availablePlayersB2.indexOf(this.playerB2))},onScoreAInput(e){this.scoreA=e.detail.value},onScoreBInput(e){this.scoreB=e.detail.value},async submitScore(){if(this.canSubmit){e.index.showLoading({title:"提交中..."});try{const t={teamA:[this.playerA1,this.playerA2],teamB:[this.playerB1,this.playerB2],scoreA:parseInt(this.scoreA),scoreB:parseInt(this.scoreB)};await a.saveDoubleMatch(t)?(e.index.showToast({title:"提交成功",icon:"success"}),this.resetForm(),this.loadTodayMatches()):e.index.showToast({title:"提交失败",icon:"error"})}catch(t){console.error("提交失败:",t),e.index.showToast({title:"提交失败",icon:"error"})}finally{e.index.hideLoading()}}},resetForm(){this.playerA1="",this.playerA2="",this.playerB1="",this.playerB2="",this.scoreA="",this.scoreB="",this.selectedPlayerA1Index=-1,this.selectedPlayerA2Index=-1,this.selectedPlayerB1Index=-1,this.selectedPlayerB2Index=-1}}};if(!Array){e.resolveComponent("custom-tabbar")()}Math;const s=e._export_sfc(t,[["render",function(a,t,s,l,r,i){return e.e({a:e.t(r.playerA1||"选择队员1"),b:r.selectedPlayerA1Index,c:i.availablePlayersA1,d:e.o(((...e)=>i.onPlayerA1Change&&i.onPlayerA1Change(...e))),e:e.t(r.playerA2||"选择队员2"),f:r.selectedPlayerA2Index,g:i.availablePlayersA2,h:e.o(((...e)=>i.onPlayerA2Change&&i.onPlayerA2Change(...e))),i:e.t(r.playerB1||"选择队员3"),j:r.selectedPlayerB1Index,k:i.availablePlayersB1,l:e.o(((...e)=>i.onPlayerB1Change&&i.onPlayerB1Change(...e))),m:e.t(r.playerB2||"选择队员4"),n:r.selectedPlayerB2Index,o:i.availablePlayersB2,p:e.o(((...e)=>i.onPlayerB2Change&&i.onPlayerB2Change(...e))),q:e.o([e=>r.scoreA=e.detail.value,(...e)=>i.onScoreAInput&&i.onScoreAInput(...e)]),r:r.scoreA,s:e.o([e=>r.scoreB=e.detail.value,(...e)=>i.onScoreBInput&&i.onScoreBInput(...e)]),t:r.scoreB,v:i.canSubmit?"":1,w:e.o(((...e)=>i.submitScore&&i.submitScore(...e))),x:!i.canSubmit,y:0===r.todayMatches.length},0===r.todayMatches.length?{}:{z:e.f(r.todayMatches,((a,t,s)=>({a:e.t(a.teamA.join("&")),b:e.t(a.teamB.join("&")),c:e.t(a.scoreA),d:e.t(a.scoreB),e:a.id})))})}],["__scopeId","data-v-16257fd9"]]);wx.createPage(s);
