"use strict";const t=require("../../common/vendor.js"),e=require("../../utils/storage.js"),a={components:{CustomTabbar:()=>"../../components/custom-tabbar/custom-tabbar.js"},data:()=>({currentTimeRange:"thisMonth",timeOptions:[{label:"历史所有",value:"all"},{label:"上月",value:"lastMonth"},{label:"昨日",value:"yesterday"},{label:"今日",value:"today"},{label:"当月",value:"thisMonth"}],statsData:{},currentMatches:[],sortField:"totalScore",sortOrder:"desc"}),computed:{dateRangeText(){const t=new Date;switch(this.currentTimeRange){case"today":return t.toISOString().split("T")[0];case"yesterday":const e=new Date(t);return e.setDate(e.getDate()-1),e.toISOString().split("T")[0];case"thisMonth":const a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=new Date(a,t.getMonth()+1,0).getDate();return`${a}-${s}-01 至 ${a}-${s}-${String(r).padStart(2,"0")}`;case"lastMonth":const o=new Date(t.getFullYear(),t.getMonth()-1,1),n=new Date(t.getFullYear(),t.getMonth(),0);return`${o.toISOString().split("T")[0]} 至 ${n.toISOString().split("T")[0]}`;default:return"全部时间"}},sortedStats(){const t=[];return Object.keys(this.statsData).forEach((e=>{const a=this.statsData[e],s=a.totalMatches>0?Math.round(a.wins/a.totalMatches*100)+"%":"0%";t.push({name:e,totalScore:a.totalScore,wins:a.wins,losses:a.losses,totalMatches:a.totalMatches,winRate:s})})),t.sort(((t,e)=>"totalScore"===this.sortField?"desc"===this.sortOrder?e.totalScore-t.totalScore:t.totalScore-e.totalScore:0))}},onLoad(){this.loadData()},onShow(){this.loadData()},methods:{async loadData(){try{const t=await e.getDoubleStats(this.currentTimeRange);this.statsData=t.stats,this.currentMatches=t.matches}catch(a){console.error("加载数据失败:",a),t.index.showToast({title:"加载失败",icon:"error"})}},changeTimeRange(t){this.currentTimeRange=t,this.loadData()},formatDate(t){let e;if("number"==typeof t)e=new Date(1e3*t);else{if("string"!=typeof t)return"--";e=new Date(t)}if(isNaN(e.getTime()))return"--";return`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},formatTeams:t=>`${t.teamA.join("&")} vs ${t.teamB.join("&")}`}};if(!Array){t.resolveComponent("custom-tabbar")()}Math;const s=t._export_sfc(a,[["render",function(e,a,s,r,o,n){return t.e({a:t.f(o.timeOptions,((e,a,s)=>({a:t.t(e.label),b:a,c:o.currentTimeRange===e.value?1:"",d:t.o((t=>n.changeTimeRange(e.value)),a)}))),b:t.t(n.dateRangeText),c:t.f(n.sortedStats,((e,a,s)=>({a:t.t(e.name),b:t.t(e.totalScore),c:t.t(e.wins),d:t.t(e.losses),e:t.t(e.winRate),f:e.name}))),d:0===o.currentMatches.length},0===o.currentMatches.length?{}:{e:t.f(o.currentMatches,((e,a,s)=>({a:t.t(n.formatDate(e.date)),b:t.t(n.formatTeams(e)),c:t.t(e.scoreA),d:t.t(e.scoreB),e:e.id})))})}],["__scopeId","data-v-f6fbfa06"]]);wx.createPage(s);
