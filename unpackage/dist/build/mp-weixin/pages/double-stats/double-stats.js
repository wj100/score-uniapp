"use strict";const t=require("../../common/vendor.js"),e=require("../../utils/storage.js"),a={data:()=>({currentTimeRange:"thisMonth",timeOptions:[{label:"历史所有",value:"all"},{label:"上月",value:"lastMonth"},{label:"昨日",value:"yesterday"},{label:"今日",value:"today"},{label:"当月",value:"thisMonth"}],statsData:{},currentMatches:[],sortField:"totalScore",sortOrder:"desc"}),onLoad(){this.loadData()},onShow(){this.loadData()},computed:{dateRangeText(){const t=new Date;switch(this.currentTimeRange){case"today":return t.toISOString().split("T")[0];case"yesterday":const e=new Date(t);return e.setDate(e.getDate()-1),e.toISOString().split("T")[0];case"thisMonth":const a=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=new Date(a,t.getMonth()+1,0).getDate();return`${a}-${o}-01 至 ${a}-${o}-${String(r).padStart(2,"0")}`;case"lastMonth":const s=new Date(t.getFullYear(),t.getMonth()-1,1),n=new Date(t.getFullYear(),t.getMonth(),0);return`${s.toISOString().split("T")[0]} 至 ${n.toISOString().split("T")[0]}`;default:return"全部时间"}},sortedStats(){const t=[];return Object.keys(this.statsData).forEach((e=>{const a=this.statsData[e],o=a.totalMatches>0?(a.wins/a.totalMatches*100).toFixed(1)+"%":"0.0%",r=a.totalMatches>0?(a.totalScore/a.totalMatches).toFixed(1):"0.0";t.push({name:e,totalScore:a.totalScore,wins:a.wins,losses:a.losses,totalMatches:a.totalMatches,winRate:o,avgScore:r})})),t.sort(((t,e)=>{let a=t[this.sortField],o=e[this.sortField];if("winRate"===this.sortField)a=parseFloat(a.replace("%","")),o=parseFloat(o.replace("%",""));else if("string"!=typeof a||isNaN(parseFloat(a))){if("string"==typeof a)return"desc"===this.sortOrder?o.localeCompare(a,"zh-CN"):a.localeCompare(o,"zh-CN")}else a=parseFloat(a),o=parseFloat(o);return"desc"===this.sortOrder?o-a:a-o}))}},onLoad(){this.loadData()},onShow(){this.loadData()},methods:{async loadData(){try{const t=await e.getDoubleStats(this.currentTimeRange);this.statsData=t.stats,this.currentMatches=t.matches}catch(a){console.error("加载数据失败:",a),t.index.showToast({title:"加载失败",icon:"error"})}},changeTimeRange(t){this.currentTimeRange=t,this.loadData()},sortBy(t){this.sortField===t?this.sortOrder="desc"===this.sortOrder?"asc":"desc":(this.sortField=t,this.sortOrder="desc")},getSortIcon(t){return this.sortField!==t?"↕":"desc"===this.sortOrder?"↓":"↑"},formatDate(t){let e;if("number"==typeof t)e=new Date(1e3*t);else{if("string"!=typeof t)return"--";e=new Date(t)}if(isNaN(e.getTime()))return"--";return`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},formatTeams:t=>`${t.teamA.join("&")} vs ${t.teamB.join("&")}`}};const o=t._export_sfc(a,[["render",function(e,a,o,r,s,n){return t.e({a:t.f(s.timeOptions,((e,a,o)=>({a:t.t(e.label),b:a,c:s.currentTimeRange===e.value?1:"",d:t.o((t=>n.changeTimeRange(e.value)),a)}))),b:t.t(n.dateRangeText),c:t.t(n.getSortIcon("name")),d:t.o((t=>n.sortBy("name"))),e:t.t(n.getSortIcon("totalScore")),f:t.o((t=>n.sortBy("totalScore"))),g:t.t(n.getSortIcon("wins")),h:t.o((t=>n.sortBy("wins"))),i:t.t(n.getSortIcon("totalMatches")),j:t.o((t=>n.sortBy("totalMatches"))),k:t.t(n.getSortIcon("winRate")),l:t.o((t=>n.sortBy("winRate"))),m:t.t(n.getSortIcon("avgScore")),n:t.o((t=>n.sortBy("avgScore"))),o:t.f(n.sortedStats,((e,a,o)=>({a:t.t(e.name),b:t.t(e.totalScore),c:t.t(e.wins),d:t.t(e.totalMatches),e:t.t(e.winRate),f:t.t(e.avgScore),g:e.name}))),p:0===s.currentMatches.length},0===s.currentMatches.length?{}:{q:t.f(s.currentMatches,((e,a,o)=>({a:t.t(n.formatDate(e.date)),b:t.t(n.formatTeams(e)),c:t.t(e.scoreA),d:t.t(e.scoreB),e:e.id})))})}],["__scopeId","data-v-b3ca8ef9"]]);wx.createPage(o);
