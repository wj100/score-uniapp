# 羽毛球数据转换工具

## 📋 功能说明

这个Python脚本用于将3.json格式的羽毛球比赛数据转换为标准的数据库格式：

- **输入**: `3.json` - 原始比赛数据
- **输出**: 
  - `22.json` - scoring_match格式（比赛记录表）
  - `33.json` - scoring_player_match格式（选手比赛详情表）

## 🚀 使用方法

### 基础版本
```bash
python3 convert_data.py
```

### 增强版本（推荐）
```bash
python3 convert_data_enhanced.py
```

## 📊 数据格式对比

### 原始格式 (3.json)
```json
{
  "createdAt": "2025-07-21T11:54:55.286Z",
  "date": "2025-07-21",
  "match": "言志-小鲁",
  "objectId": "687e2a8f5a1556636a36e748",
  "score": "15 - 13",
  "updatedAt": "2025-07-21T11:54:55.286Z"
}
```

### 转换后格式

#### 22.json (scoring_match)
```json
{
  "_id": {"$oid": "9d12cc92b5e3434782ec3201"},
  "time": {"$date": "2025-07-21T11:54:55.286Z"},
  "match_type": 1,
  "player1": "言志",
  "player2": "小鲁",
  "score1": 15,
  "score2": 13,
  "match_name": ""
}
```

#### 33.json (scoring_player_match)
```json
{
  "_id": {"$oid": "6a7cd95d0b0f42278cf55429"},
  "match_id": {"$oid": "52abc0194d804cc5aee1352a"},
  "time": {"$date": "2025-07-21T11:54:55.286Z"},
  "match_type": 1,
  "player": "言志",
  "score": 15,
  "result": 1
}
```

## 🎯 功能特性

### 基础版本
- ✅ 基本数据转换
- ✅ 自动生成ObjectId
- ✅ 时间格式转换
- ✅ 比分解析

### 增强版本
- ✅ 智能比赛格式解析
- ✅ 支持多种比分格式
- ✅ 数据验证和错误处理
- ✅ 详细统计报告
- ✅ 选手信息收集
- ✅ 数据质量检查

## 📈 转换统计

根据实际数据转换结果：

- **原始记录**: 216条
- **单打比赛**: 216场
- **双打比赛**: 0场
- **涉及选手**: 5人（小鲁、建华、杭宁、汪骏、言志）
- **转换成功率**: 100%
- **时间范围**: 2025-07-21 到 2025-09-26

## 🔧 支持的格式

### 比赛格式
- 单打: `"言志-小鲁"`, `"言志 vs 小鲁"`
- 双打: `"言志&小鲁-建华&言志"`, `"言志&小鲁 vs 建华&言志"`

### 比分格式
- `"15 - 13"`
- `"15:13"`
- `"15-13"`

## 📁 文件说明

| 文件 | 描述 | 记录数 |
|------|------|--------|
| `3.json` | 原始数据 | 216 |
| `22.json` | 比赛记录表 | 216 |
| `33.json` | 选手详情表 | 432 |

## ⚠️ 注意事项

1. **数据备份**: 转换前请备份原始数据
2. **格式验证**: 转换后请验证数据格式正确性
3. **时间格式**: 确保时间格式符合MongoDB要求
4. **编码问题**: 处理中文字符时注意编码设置

## 🛠️ 故障排除

### 常见问题

1. **文件不存在**: 确保3.json文件在当前目录
2. **编码错误**: 使用UTF-8编码保存文件
3. **格式错误**: 检查JSON格式是否正确
4. **权限问题**: 确保有写入权限

### 错误处理

脚本包含完善的错误处理机制：
- 自动跳过格式错误的记录
- 详细的错误日志输出
- 转换成功率统计

## 📞 技术支持

如有问题，请检查：
1. Python版本（推荐3.6+）
2. 文件编码格式
3. JSON语法正确性
4. 文件权限设置
